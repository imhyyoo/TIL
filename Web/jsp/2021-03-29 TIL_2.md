## 2021-03-27 TIL

### 😁 웹 애플리케이션이란? 

​	웹 기반으로 실행되는 프로그램을 말한다. 클라이언트와 서버의 요청(Request)과  응답(Response)관계 속에서 이루어진다. 클라이언트는 서비스를 요청하고 서버는 클라이언트의 요청을 처리하여 결과화면으로 출력한다. 

#### 📌 웹 어플리케이션 구성 요소

1. 웹 브라우저

   사용자가 요청한 웹 서버의 결과를 화면에 출력해주는 어플리케이션

2. 웹 서버

   웹 브라우저의 요청을 받아 알맞은 결과를 웹 브라우저에게 응답해준다. 웹 서버는 변화가 없는 정적 페이지를 반환한다. 웹 서버에 파일형태로 저장되어 있는 HTML 문서를 정적페이지라고 한다. 

3. 웹 어플리케이션 서버(WAS , Web Application Server)

   동적인 페이지를 반환한다. 동적 페이지는 인자 값에 따라 결과가 달라지는 페이지들을 반환한다. 웹 애플리케이션이 생성하는 HTML 문서를 동적 페이지라고 한다. 

4.  데이터베이스

   데이터를 저장하는 곳이다.

#### 📌 WAS(Web Application Server)

​	동적인 컨텐츠를 제공하기 위해 만들어진 서버이다. WAS는 `웹 서버` 와 `웹 컨테이너` 역할을 한다. WAS는 프로그램 실행 환경과 데이터베이스와의 연결 기능을 제공하고 여러개의 트랜잭션을 관리한다. 업무를 처리하는 비지니스 로직을 수행한다. 

​	WAS를 웹 컨테이너(Web Container) 또는 서블릿 컨테이너(Servlet Container) 라고 부를 수 있다. 컨테이너는 JSP, Servlet을 실행시킬 수 있는 소프트웨어를 말한다.  

#### 📌 서블릿(Servlet) 과 JSP(Java Server Page)

​	`서블릿(Servlet)`은 자바를 이용한 동적 페이지를 생성하는 서버 프로그래밍 기술이다. `JSP(Java Server Page)` HTML 내에 자바 코드를 삽입하여 동적 페이지를 생성하는 스크립트 언어이다. 



### 😁 JSP(Java Server Page)

​	JSP는 HTML 문서 사이에 JSP 문법의 코드가 삽입되는 형태로 작성한다. JSP 페이지에 있는 HTML 코드는 웹 브라우저로 그대로 전송되지만 `JSP 문법 코드`는 실행되고 그 결과인 HTML 코드만 웹 브라우저로 전송된다.

```jsp
// 페이지 지시자
<%@ page language = "java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<HTML>
    <HEAD>
        <TITLE>1부터 100까지의 합</TITLE>
    </HEAD>
    <BODY>
        <% 
        	// 스크립트릿 
        	int total = 0;
        	for(int i=0; i<=100; i++){
                total += i;
            }
        %>
        <p>
            // 표현식
            1부터 100까지의 합은 <%= total%>
        </p>
    </BODY>
</HTML>
```

* **지시자** : 웹 컨테이너가 JSP를 서블릿 클래스로 변환할 때 필요한 정보를 기술. 지시자 종류에는 다음과 같은 것이 있다.

  <%@page %>, <%@include %>, <%@taglib %>

* **스크립트 릿** : jsp 문서 내에 자바 코드를 기술하는 부분. <% %> 사이에 자바 명령어를 작성한다.

* **표현식** : jsp 페이지 내에 자바식을 표현한다. <%= %> 로 표현하고 그 사이에 상수나 변수, 리턴 값이 있는 메서드가 들어올 수 있다.

#### 📌 JSP 특징

* 서블릿으로 컴파일 된 후 메모리에서 처리되기 때문에 많은 접속도 원활하게 처리가능.
* 다른 서블릿 간 데이터 공유가 쉬움
* 자바의 모든 기능 사용 가능
* 커스텀 태그를 만들어 사용가능하고 JSTL같은 태그 라이브러리 사용 가능
* 다양한 프레임워크와 결합하여 개발 가능

#### 📌 JSP 처리 과정

* **JSP와 서블릿의 차이** : JSP는 HTML과 같은 일반적인 텍스트 파일 구조, 서블릿은 HTML 이 자바 소스로 작성된 파일이라고 생각하면 된다.
* **서블릿 컨테이너** : JSP, 서블릿의 실행 환경
* **JSP 서블릿 컴파일 처리 과정**

![2](C:\Users\imhyy\OneDrive\바탕 화면\이미지\2.jpg)

1. 웹 서버로부터 JSP에 대한 사용자 요청이 컨테이너로 전달된다. 
2. 요청 JSP에 대한 서블릿이 존재하면 서블릿을 실행하고 존재하지 않다면 JSP를 java 파일로 변환한 후 `.class` 파일로 컴파일한다. 
3. 컴파일된 서블릿 클래스를 메모리에 올려 실행한다.
4. 데이터베이스 처리 혹은 별도의 기능을 위한 클래스 호출이 있다면 결과를 취합해 HTML 로 구성.
5. HTML 형태의 결과를 웹 서버를 경유해 사용자 브라우저에 전달한다.

* **JSP와 서블릿 변환과 상태 변화**

1. JSP 파일은 일반 텍스트를 비롯해 HTML 코드와 특수 태그, 자바 코드가 섞여있다.
2. 서블릿으로 변환된 JSP는 `컨테이너에 의해 생명주기`가 관리된다.
3. 서브릿으로 변환된 JSP는 `jspInit() 메서드에 의해 실행`되고 Ready 상태가 되며 이후 사용자 요청은 `jspService() 메서드가 쓰레드 형태로 호출`되어 실행된다. 
4. 컨테이너에 의해 JSP 서블릿이 종료될 때에는 `jspDestory()` 메서드가 실행된다.

서블릿 클래스가 존재하지 않는 경우 jsp 파일을 자바 소스 파일로 변환한 후 클래스 파일로 컴파일한다. 컴퓨터에서 실행 가능한 형태인 클래스 파일은 소스가 변경되기 전까지 메모리에 상주하며 다시 컴파일 되지 않고 서비스된다 (jsp 파일이 수정되기 전까지). 

#### 📌 JSP의 생명주기 메서드

​	JSP 파일의 실행과 종료에 관계하는 메서드를 생명주기 메서드라고 한다. 컴파일된 JSP는 서블릿 실행과정에서 `jspInit()` 메서드를 통해 Ready 상태가 되고 메모리에 올라온다. 그리고 클라이언트 접속에 따라 `jspService()` 메서드를 반복해서 호출한다. 컨테이너가 종료될 때는 `jspDestory()` 메서드를 통해 메모리에서 언로드된다. 

#### 📌 jsp 유형

1. 빈즈 클래스를 사용하지 않고 스크립트만을 이용
2. 빈즈 클래스와 < jsp:useBean > 액션 태그를 사용하는 방법



### 😁 서블릿

​	자바를 기반으로 하는 웹 애플리케이션 기술. JSP는 서블릿 기반의 웹 스크립트 언어로 내부적으로 서블릿으로 변환되어 실행된다.

#### 📌 서블릿의 장점

1. 자바를 기반으로 하여 자바 API를 모두 사용 가능하다
2. OS나 HW에 영향을 받지 않고 다양한 서버 환경에서도 실행할 수 있다
3. 웹 애플리케이션에서 효율적인 자료 공유 방법을 제공한다
4. 다양한 오픈소스 라이브러리와 개발 도구를 활용할 수 있다
5. MVC 패턴을 쉽게 적용할 수 있고 컨테이너와 밀접한 프로그램을 구현

 #### 📌 서블릿 동작 과정

서블릿은 개발자가 소스 작성 후 컴파일 과정을 거쳐 컨테이너에 배치되면 컨테이너에 의해 실행되어 관리된다. 사용자 요청에 따라 스레드 단위로 실행되면서 데이터베이스 연동 등 다양한 작업을 수행하고 처리 결과를 사용자에게 HTML 형식으로 전달한다. 

> 생명주기

​	서블릿 컨테이너에 의해 실행되면서 생명주기를 가진다. `생명주기` 란 서블릿이 컨테이너에 의해 실행, 서비스, 종료되는 일련의 과정을 말한다.

​	서블릿 개발은 해당 생명주기 메서드를 오버라이딩하거나 `doGet() , doPost()` 와 같은 사용자 요청 처리 메서드를 구현하는 것이다.

* **init()** : 서블릿 실행시 한번만 실행되는 메서드
* **service()** : 사용자 요청 시 매번 호출되는 메서드
* **destory()** : 서블릿 종료 시 실행되는 메서드

1. 컨테이너가 서블릿 클래스를 메모리에 로딩한다
2. 서블릿 클래스 생성자 메서드를 호출해서 인스턴스를 생성한다
3. 생성된 인스턴스의 `init` 메서드가 호출된다. 서블릿 생명주기에서 단 한 번만 실행. 초기화를 한다.
4. 서블릿에 대한 사용자의 요청에 대해서는 `web.xml` 파일 혹은 `애너테이션` 을 참조해서 URL 매핑을 확인하고 해당 서블릿 인스턴스로부터 스레드를 생성하고 `service()` 메서드를 호출한다.
5. 모든 사용자 요청에 대해서 개별적인 `service`가 호출되며 `GET/POST` 에 대해 doGet이나 doPost 메서드가 호출된다. 
6. `destory` 메서드는 서블릿이 종료될 때 호출되는 메서드다.

#### 📌 서블릿 구조와 API

​	서블릿은 일반적인 자바 클래스 구조를 갖는다. 서블릿은 컨테이너에 의해 실행되므로 특정 클래스를 상속 받아야만 구현할 수 있는 구조다. `서블릿 API`는 서블릿과 서블릿 컨테이너 사이의 인터페이스를 정의한다. 서블릿은 `javax.servlet.http.HttpServlet`클래스를 상속해서 구현함.

 #### 📌 GET 방식과 POST 방식

1. GET 방식

   서버에 있는 정보를 가져오기 위해 설계된 데이터 전달방법. 서버에 최대 240 byte 까지 데이터를 전달할 수 있다. `QUERY_STRING` 환경 변수를 통해서 서버로 전달되는데 `QUERY_STRING` 형식은 다음과 같다. 

   ` www.xxx.com/servlet/login?id=hi&name=hello`

   `?` 이후의 값들은 서버에서 QUERY_STRING을 통해 전달된다. 속성=값 형태로 사용해야 하며 `&` 는 여러 속성 값을 전달할 때 연결해주는 문자열이다. URL에 전달 값이 노출되기 때문에 보안상 문제가 생길 수 있다.

2. POST 방식

   서버로 정보를 전달하려고 설계된 방법이다. 데이터 크기에는 제한이 없고 URL에 매개변수가 표시되지 않는다. 

#### 📌 init() / service() / destory()

1. 서블릿 초기화 : init() 메서드

   클라이언트 요청이 들어오면 컨테이너는 서블릿이 메모리에 있는지 확인한다. 메모리에 없다면 서블릿을 메모리에 다시 적재해야하는데 이 때 서블릿의 `init()` 가 호출되며 각종 초기화 작업을 한다. 실행 중에 서블릿이 변경된 경우 `destory` 후 새로운 내용을 다시 적재하려고 `init` 메서드가 호출된다. 

2. 요청/응답 : service() 메서드

   이후 요청들은 스레드로 실행되며 `service` 나 `doGet, doPost` 로 분기된다. 이 때 파라미터로 `HttpServletRequest` 와 `HttpServletResponse` 클래스 타입인 `request` , `response` 객체가 제공되는데 사용자 요청 처리는 `request`로 응답 처리는 `response` 객체로 처리한다. 

3. 서블릿 종료 : 컨테이너로부터 서블릿 종료 요청이 있을 때 `destory` 메서드를 호출한다. 